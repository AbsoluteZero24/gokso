{{ define "assets/asetkso" }}
<style>
  /* Custom DataTables Styling */
  .datatable-wrapper .datatable-top {
    padding: 15px 0;
    display: flex;
    justify-content: flex-end;
  }
  
  .datatable-wrapper .datatable-bottom {
    padding: 15px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid #dee2e6;
    margin-top: 10px;
  }

  /* Move selector to bottom next to info */
  .datatable-wrapper .datatable-top .datatable-dropdown {
    display: none;
  }

  .datatable-bottom-left {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .datatable-input {
    border: 1px solid #0d6efd;
    border-radius: 8px;
    padding: 8px 15px;
    background-color: #fff;
    color: #000;
    transition: all 0.3s ease;
    min-width: 250px;
  }

  .datatable-input:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    outline: none;
    border-color: #0b5ed7;
  }

  .datatable-selector {
    border: 1px solid #0d6efd;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
    background-color: #fff;
    color: #000;
  }

  /* Premium Table Styling */
  #table-asetkso {
    border-collapse: separate !important;
    border-spacing: 0 !important;
    border: 1px solid #dee2e6 !important;
    border-radius: 10px !important;
    overflow: hidden !important;
  }

  #table-asetkso thead th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #0d6efd !important;
    font-weight: 400;
    color: #333;
    padding: 12px;
    text-align: center;
  }

  #table-asetkso tbody td {
    border: 1px solid #dee2e6 !important;
    padding: 12px;
    vertical-align: middle;
  }

  #table-asetkso tbody tr:hover {
    background-color: #f1f7ff;
    transition: background-color 0.2s;
  }

  .badge {
    padding: 6px 10px;
    border-radius: 6px;
  }

</style>

        <!--begin::App Content Header-->
        <div class="app-content-header">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <div class="col-sm-6"><h3 class="mb-0">{{ .title }}</h3></div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="/">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Aset KSO</li>
                </ol>
              </div>
            </div>
            <!--end::Row-->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content Header-->
        <!--begin::App Content-->
        <div class="app-content">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <div class="col-12">
                <div class="card">
                  <div class="card-header d-flex align-items-center justify-content-between">
                    <h3 class="card-title mb-0">Data Aset KSO</h3>
                    <div class="card-tools d-flex gap-2 ms-auto">
                      <a href="/inventori/aset-laptop/bulk-create" class="btn btn-success btn-sm">
                        <i class="bi bi-stack"></i> Sisipan Masal
                      </a>
                      <a href="/inventori/aset-laptop/create" class="btn btn-primary btn-sm">
                        <i class="bi bi-plus"></i> Tambah Aset
                      </a>
                    </div>
                  </div>
                  <!-- /.card-header -->
                  <div class="card-body">
                    <!-- Filter & Search Section -->
                    <div class="d-flex align-items-center justify-content-between mb-4 gap-3">
                      <!-- Filter Section -->
                      <div class="filter-wrapper p-2 bg-light rounded border shadow-sm" style="max-width: fit-content;">
                        <form action="/inventori/aset-laptop" method="GET" id="filterForm" class="d-flex align-items-center gap-3 px-2">
                          <label for="year_filter" class="fw-bold mb-0 small text-muted text-uppercase">Filter Tahun:</label>
                          <div class="input-group input-group-sm" style="width: 160px;">
                            <span class="input-group-text bg-white border-end-0"><i class="bi bi-calendar3"></i></span>
                            <input type="text" name="year" id="year_filter" class="form-control border-start-0 ps-0" placeholder="Semua Tahun" value="{{ .selectedYear }}" readonly>
                            {{ if .selectedYear }}
                            <button type="button" class="btn btn-outline-danger btn-sm border-start-0" title="Reset Filter" onclick="window.location.href='/inventori/aset-laptop'">
                              <i class="bi bi-x-lg"></i>
                            </button>
                            {{ end }}
                          </div>
                        </form>
                      </div>

                      <!-- Search Container (Target for JS) -->
                      <div id="datatable-search-container"></div>
                    </div>

                    <table class="table table-bordered" id="table-asetkso">
                      <thead>
                        <tr>
                          <th style="width: 10px">No</th>
                          <th>No. Inventaris</th>
                          <th>Serial Number</th>
                          <th>Nama Aset</th>
                          <th>Kategori</th>
                           <th>Merk</th>
                           <th>Type/Model</th>
                           <th>Spesifikasi</th>
                          <th>Lokasi</th>
                          <th>Tgl. Pembelian</th>
                          <th>Status</th>
                          <th style="width: 100px">Aksi</th>
                        </tr>
                      </thead>
                      <tbody>
                        {{ range $index, $asset := .assets }}
                        <tr>
                          <td class="text-center row-index">{{ add $index 1 }}.</td>
                          <td><span class="text-dark">{{ $asset.InventoryNumber }}</span></td>
                          <td>{{ $asset.SerialNumber }}</td>
                          <td>{{ $asset.AssetName }}</td>
                           <td>{{ $asset.Category }}</td>
                          <td>{{ $asset.Brand }}</td>
                           <td>{{ $asset.TypeModel }}</td>
                           <td>{{ $asset.Specification }}</td>
                          <td>{{ $asset.Location }}</td>
                          <td>{{ $asset.PurchaseDate.Format "02-01-2006" }}</td>
                          <td>
                            {{ if eq $asset.Status "Ready" }}
                              <span class="badge bg-primary">Ready</span>
                            {{ else if eq $asset.Status "Rusak" }}
                              <span class="badge bg-danger">Rusak</span>
                            {{ else }}
                              <span class="badge bg-secondary">{{ $asset.Status }}</span>
                            {{ end }}
                          </td>
                          <td>
                            <div class="btn-group">
                              <a href="/inventori/aset-laptop/edit/{{ $asset.ID }}" class="btn btn-warning btn-sm">
                                <i class="bi bi-pencil"></i>
                              </a>
                              <a href="/inventori/aset-laptop/delete/{{ $asset.ID }}" class="btn btn-danger btn-sm" onclick="return confirm('Apakah Anda yakin ingin menghapus data ini?')">
                                <i class="bi bi-trash"></i>
                              </a>
                            </div>
                          </td>
                        </tr>
                        {{ end }}
                      </tbody>
                    </table>
                  </div>
                  <!-- /.card-body -->
                </div>
                <!-- /.card -->
              </div>
            </div>
            <!-- /.row -->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content-->

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tableElement = document.getElementById('table-asetkso');
        if (tableElement) {
            const dataTable = new simpleDatatables.DataTable(tableElement, {
                searchable: true,
                fixedHeight: false,
                perPage: 10,
                labels: {
                    placeholder: "Cari aset...",
                    perPage: "{select}",
                    noRows: "Data tidak ditemukan",
                    info: "Menampilkan {start} sampai {end} dari {rows} data",
                },
                columns: [
                    { select: 0, sortable: false },
                    { select: 1, sort: "asc" }
                ]
            });

            const updateRowNumbers = () => {
                // Wait for the library to finish rendering the DOM
                setTimeout(() => {
                    const wrapper = tableElement.closest('.datatable-wrapper');
                    const infoElement = wrapper ? wrapper.querySelector('.datatable-info') : null;
                    let startIdx = 0;

                    if (infoElement) {
                        // Extract the first number from the info text (e.g., "Menampilkan 6 sampai 10...")
                        const match = infoElement.innerText.match(/\d+/);
                        if (match) {
                            startIdx = parseInt(match[0]) - 1;
                        }
                    }

                    const rows = tableElement.querySelectorAll('tbody tr');
                    rows.forEach((row, index) => {
                        const cell = row.querySelector('.row-index');
                        if (cell && !row.classList.contains('datatable-empty')) {
                            cell.innerText = (startIdx + index + 1) + ".";
                        }
                    });
                }, 50);
            };

            // Bind events for numbering updates
            dataTable.on("datatable.page", updateRowNumbers);
            dataTable.on("datatable.sort", updateRowNumbers);
            dataTable.on("datatable.perpage", updateRowNumbers);
            dataTable.on("datatable.search", updateRowNumbers);

            // Move elements after init for premium layout
            dataTable.on("datatable.init", () => {
                updateRowNumbers();
                const topBar = document.querySelector(".datatable-top");
                const searchDiv = topBar.querySelector(".datatable-search");
                const searchContainer = document.getElementById("datatable-search-container");
                
                // Move Search Input to align with Year Filter
                if (searchDiv && searchContainer) {
                    searchContainer.appendChild(searchDiv);
                    const searchInput = searchDiv.querySelector(".datatable-input");
                    if (searchInput) {
                        searchInput.style.margin = "0";
                    }
                }

                // Hide original top bar since we moved/hidden its contents
                if (topBar) topBar.style.display = "none";

                // Move the original "per page" selector to bottom instead of cloning
                const topDropdown = topBar.querySelector(".datatable-dropdown");
                const bottomContainer = document.querySelector(".datatable-bottom");
                
                if (topDropdown && bottomContainer) {
                    const bottomLeft = document.createElement("div");
                    bottomLeft.className = "datatable-bottom-left";
                    
                    // Clear text nodes from label but keep select
                    const label = topDropdown.querySelector("label");
                    if (label) {
                        const selector = label.querySelector(".datatable-selector");
                        label.innerHTML = "";
                        if (selector) label.appendChild(selector);
                    }
                    
                    bottomLeft.appendChild(topDropdown);
                    
                    const info = bottomContainer.querySelector(".datatable-info");
                    if (info) bottomLeft.appendChild(info);
                    
                    bottomContainer.insertBefore(bottomLeft, bottomContainer.firstChild);
                }
            });
        }

        // Initialize Year Filter with Flatpickr
        flatpickr("#year_filter", {
            dateFormat: "Y",
            altFormat: "Y",
            onChange: function(selectedDates, dateStr, instance) {
                if (dateStr) {
                    document.getElementById('filterForm').submit();
                }
            }
        });
    });
</script>
{{ end }}
