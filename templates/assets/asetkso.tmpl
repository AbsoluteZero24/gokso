{{ define "assets/asetkso" }}
<style>
  /* Custom DataTables Styling */
  .datatable-wrapper .datatable-top {
    padding: 15px 0;
    display: flex;
    justify-content: flex-end;
  }
  
  .datatable-wrapper .datatable-bottom {
    padding: 15px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid #dee2e6;
    margin-top: 10px;
  }

  /* Move selector to bottom next to info */
  .datatable-wrapper .datatable-top .datatable-dropdown {
    display: none;
  }

  .datatable-bottom-left {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .datatable-input {
    border: 1px solid #0d6efd;
    border-radius: 8px;
    padding: 8px 15px;
    background-color: #fff;
    color: #000;
    transition: all 0.3s ease;
    min-width: 250px;
  }

  .datatable-input:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    outline: none;
    border-color: #0b5ed7;
  }

  .datatable-selector {
    border: 1px solid #0d6efd;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
    background-color: #fff;
    color: #000;
  }

  /* Premium Table Styling */
  #table-asetkso {
    border-collapse: separate !important;
    border-spacing: 0 !important;
    border: 1px solid #dee2e6 !important;
    border-radius: 10px !important;
    overflow: hidden !important;
  }

  #table-asetkso thead th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #0d6efd !important;
    font-weight: 400;
    color: #333;
    padding: 12px;
    text-align: center;
  }

  #table-asetkso tbody td {
    border: 1px solid #dee2e6 !important;
    padding: 12px;
    vertical-align: middle;
  }

  #table-asetkso tbody tr:hover {
    background-color: #f1f7ff;
    transition: background-color 0.2s;
  }

  .badge {
    padding: 6px 10px;
    border-radius: 6px;
  }

  /* Modern Filter Styling */
  .filter-pill {
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 50px;
    padding: 4px 12px;
    transition: all 0.2s ease;
    min-height: 42px;
  }

  .filter-pill:hover {
    border-color: #0d6efd !important;
    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.08) !important;
  }

  .filter-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: rgba(13, 110, 253, 0.05);
    border-radius: 50%;
    margin-right: 10px;
  }

  .filter-select-wrapper {
    min-width: 140px;
  }

  .filter-select-wrapper select {
    font-size: 0.9rem;
    color: #444;
    cursor: pointer;
    box-shadow: none !important;
  }

  .filter-reset {
    color: #dc3545;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    margin-left: 8px;
    transition: transform 0.2s ease;
    text-decoration: none;
  }

  .filter-reset:hover {
    color: #b02a37;
    transform: scale(1.1);
  }

  /* Modern Search Styling */
  .search-pill {
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 50px;
    padding: 4px 15px;
    transition: all 0.2s ease;
    min-height: 42px;
    min-width: 250px;
  }

  .search-pill:focus-within {
    border-color: #0d6efd !important;
    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.1) !important;
  }

  .search-icon-wrapper {
    color: #0d6efd;
    margin-right: 10px;
    display: flex;
    align-items: center;
  }

</style>

        <!--begin::App Content Header-->
        <div class="app-content-header">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <div class="col-sm-6"><h3 class="mb-0">{{ .title }}</h3></div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="/">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Aset KSO</li>
                </ol>
              </div>
            </div>
            <!--end::Row-->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content Header-->
        <!--begin::App Content-->
        <div class="app-content">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <div class="col-12">
                <div class="card">
                  <div class="card-header d-flex align-items-center justify-content-between">
                    <h3 class="card-title mb-0">Data Aset KSO</h3>
                    <div class="card-tools d-flex gap-2 ms-auto">
                      <button type="button" id="btn-bulk-delete" class="btn btn-danger btn-sm d-none" onclick="confirmBulkDelete()">
                        <i class="bi bi-trash-fill"></i> Hapus Terpilih (<span id="selected-count">0</span>)
                      </button>
                      <a href="/inventori/aset-laptop/bulk-create" class="btn btn-success btn-sm">
                        <i class="bi bi-stack"></i> Sisipan Masal
                      </a>
                      <a href="/inventori/aset-laptop/create" class="btn btn-primary btn-sm">
                        <i class="bi bi-plus"></i> Tambah Aset
                      </a>
                    </div>
                  </div>
                  <!-- /.card-header -->
                  <div class="card-body">
                    <!-- Filter & Search Section -->
                    <div class="d-flex align-items-center justify-content-between mb-4 gap-3">
                      <!-- Filter Section -->
                      <div class="filter-container">
                        <form action="/inventori/aset-laptop" method="GET" id="filterForm" class="d-flex align-items-center">
                          <div class="filter-pill shadow-sm border">
                            <div class="filter-icon">
                              <i class="bi bi-calendar-event-fill text-primary"></i>
                            </div>
                            <div class="filter-select-wrapper">
                              <select name="year" id="year_filter" class="form-select border-0 bg-transparent py-0 fw-semibold" onchange="document.getElementById('filterForm').submit()">
                                <option value="">Semua Tahun</option>
                                {{ range $y := .years }}
                                  <option value="{{ $y }}" {{ if eq $.selectedYear (printf "%d" $y) }}selected{{ end }}>Tahun {{ $y }}</option>
                                {{ end }}
                              </select>
                            </div>
                            {{ if .selectedYear }}
                            <a href="/inventori/aset-laptop?year=" class="filter-reset" title="Hapus Filter">
                              <i class="bi bi-x-circle-fill"></i>
                            </a>
                            {{ end }}
                          </div>
                        </form>
                      </div>

                      <!-- Custom Search Section -->
                      <div class="search-container">
                        <div class="search-pill shadow-sm border">
                          <div class="search-icon-wrapper">
                            <i class="bi bi-search"></i>
                          </div>
                          <input type="text" id="custom-search-input" class="form-control border-0 bg-transparent p-0 shadow-none" 
                                 placeholder="Cari aset..." style="font-size: 0.9rem; font-weight: 500;">
                        </div>
                      </div>
                    </div>

                    <form id="bulk-delete-form" action="/inventori/aset-laptop/bulk-delete" method="POST">
                    <table class="table table-bordered" id="table-asetkso">
                      <thead>
                          <th style="width: 10px">
                            <input type="checkbox" id="check-all" class="form-check-input">
                          </th>
                          <th style="width: 10px">No</th>
                          <th>No. Inventaris</th>
                          <th>Serial Number</th>
                          <th>Nama Aset</th>
                          <th>Kategori</th>
                           <th>Merk</th>
                           <th>Type/Model</th>
                           <th>Spesifikasi</th>
                          <th>Lokasi</th>
                          <th>Tgl. Pembelian</th>
                          <th>Status</th>
                          <th style="width: 100px">Aksi</th>
                        </tr>
                      </thead>
                      <tbody>
                        {{ range $index, $asset := .assets }}
                        <tr>
                          <td>
                            <input type="checkbox" name="ids" value="{{ $asset.ID }}" class="form-check-input row-checkbox">
                          </td>
                          <td class="text-center row-index">{{ add $index 1 }}.</td>
                          <td><span class="text-dark">{{ $asset.InventoryNumber }}</span></td>
                          <td>{{ $asset.SerialNumber }}</td>
                          <td>{{ $asset.AssetName }}</td>
                           <td>{{ $asset.Category }}</td>
                          <td>{{ $asset.Brand }}</td>
                           <td>{{ $asset.TypeModel }}</td>
                           <td>{{ $asset.Specification }}</td>
                          <td>{{ $asset.Location }}</td>
                          <td>{{ $asset.PurchaseDate.Format "02-01-2006" }}</td>
                          <td>
                            {{ if eq $asset.Status "Ready" }}
                              <span class="badge bg-primary">Ready</span>
                            {{ else if eq $asset.Status "Rusak" }}
                              <span class="badge bg-danger">Rusak</span>
                            {{ else }}
                              <span class="badge bg-secondary">{{ $asset.Status }}</span>
                            {{ end }}
                          </td>
                          <td>
                            <div class="btn-group">
                              <a href="/inventori/aset-laptop/edit/{{ $asset.ID }}" class="btn btn-warning btn-sm">
                                <i class="bi bi-pencil"></i>
                              </a>
                              <a href="/inventori/aset-laptop/delete/{{ $asset.ID }}" class="btn btn-danger btn-sm" onclick="return confirm('Apakah Anda yakin ingin menghapus data ini?')">
                                <i class="bi bi-trash"></i>
                              </a>
                            </div>
                          </td>
                        </tr>
                        {{ end }}
                      </tbody>
                    </table>
                    </form>
                  </div>
                  <!-- /.card-body -->
                </div>
                <!-- /.card -->
              </div>
            </div>
            <!-- /.row -->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content-->

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tableElement = document.getElementById('table-asetkso');
        if (!tableElement) return;

        /* 
         * ==========================================================
         * 1. KONFIGURASI DATATABLE
         * ==========================================================
         * Menggunakan library simple-datatables dengan ekstensi kustom
         * untuk pencarian dan logika penomoran baris.
         */
        const dataTable = new simpleDatatables.DataTable(tableElement, {
            searchable: false, // Nonaktifkan pencarian bawaan agar bisa pakai search pill buatan sendiri
            fixedHeight: false,
            perPage: 10,
            labels: {
                perPage: "{select}",
                noRows: "Data tidak ditemukan",
                info: "Menampilkan {start} sampai {end} dari {rows} data",
            },
            columns: [
                { select: 0, sortable: false }, // Kolom Checkbox
                { select: 1, sortable: false }, // Kolom Nomor
                { select: 2, sort: "asc" }     // Urutan default (No. Inventaris)
            ]
        });

        /* 
         * ==========================================================
         * 2. LOGIKA PENCARIAN KUSTOM
         * ==========================================================
         * Menghubungkan input pencarian kustom ke API DataTable.
         */
        const customSearchInput = document.getElementById('custom-search-input');
        if (customSearchInput) {
            customSearchInput.addEventListener('input', (e) => {
                dataTable.search(e.target.value);
            });
        }

        /* 
         * ==========================================================
         * 3. PENOMORAN BARIS DINAMIS
         * ==========================================================
         * Memperbaiki indeks nomor baris (1, 2, 3...) saat sorting 
         * atau pagination berubah sesuai dengan offset saat ini.
         */
        const updateRowNumbers = () => {
            setTimeout(() => {
                const wrapper = tableElement.closest('.datatable-wrapper');
                const infoElement = wrapper ? wrapper.querySelector('.datatable-info') : null;
                let startIdx = 0;

                if (infoElement) {
                    // Ambil angka awal dari teks "Menampilkan X sampai Y..."
                    const match = infoElement.innerText.match(/\d+/);
                    if (match) startIdx = parseInt(match[0]) - 1;
                }

                tableElement.querySelectorAll('tbody tr').forEach((row, index) => {
                    const cell = row.querySelector('.row-index');
                    if (cell && !row.classList.contains('datatable-empty')) {
                        cell.innerText = (startIdx + index + 1) + ".";
                    }
                });
            }, 50);
        };

        /* 
         * ==========================================================
         * 4. HANDLER HAPUS MASSAL (BULK DELETE)
         * ==========================================================
         * Mengelola status pemilihan checkbox dan menampilkan/menyembunyikan
         * tombol "Hapus Terpilih" berdasarkan pilihan user.
         */
        const checkAll = document.getElementById('check-all');
        const btnBulkDelete = document.getElementById('btn-bulk-delete');
        const selectedCountSpan = document.getElementById('selected-count');
        
        const updateBulkDeleteState = () => {
            const checkedCount = tableElement.querySelectorAll('.row-checkbox:checked').length;
            if (selectedCountSpan) selectedCountSpan.innerText = checkedCount;
            
            if (checkedCount > 0) {
                btnBulkDelete?.classList.remove('d-none');
            } else {
                btnBulkDelete?.classList.add('d-none');
            }
        };

        if (checkAll) {
            checkAll.addEventListener('change', function() {
                tableElement.querySelectorAll('.row-checkbox').forEach(cb => {
                    cb.checked = this.checked;
                });
                updateBulkDeleteState();
            });
        }

        tableElement.addEventListener('change', function(e) {
            if (e.target.classList.contains('row-checkbox')) {
                const allSelected = tableElement.querySelectorAll('.row-checkbox').length === 
                                  tableElement.querySelectorAll('.row-checkbox:checked').length;
                if (checkAll) checkAll.checked = allSelected;
                updateBulkDeleteState();
            }
        });

        window.confirmBulkDelete = () => {
            const count = tableElement.querySelectorAll('.row-checkbox:checked').length;
            if (confirm(`Apakah Anda yakin ingin menghapus ${count} data terpilih?`)) {
                document.getElementById('bulk-delete-form').submit();
            }
        };

        /* 
         * ==========================================================
         * 5. PENGIKATAN EVENT TABEL
         * ==========================================================
         */
        const handleTableUpdate = () => {
            updateRowNumbers();
            if (checkAll) checkAll.checked = false;
            updateBulkDeleteState();
        };

        dataTable.on("datatable.page", handleTableUpdate);
        dataTable.on("datatable.sort", handleTableUpdate);
        dataTable.on("datatable.perpage", handleTableUpdate);
        dataTable.on("datatable.search", handleTableUpdate);

        dataTable.on("datatable.init", () => {
            handleTableUpdate();
            
            // Penyesuaian Layout Premium
            const topBar = document.querySelector(".datatable-top");
            if (topBar) topBar.style.display = "none"; // Sembunyikan baris atas bawaan
            
            // Pindahkan pilihan "entries per page" ke footer
            const topDropdown = topBar?.querySelector(".datatable-dropdown");
            const bottomContainer = document.querySelector(".datatable-bottom");
            
            if (topDropdown && bottomContainer) {
                const bottomLeft = document.createElement("div");
                bottomLeft.className = "datatable-bottom-left d-flex align-items-center";
                
                const label = topDropdown.querySelector("label");
                if (label) {
                    const selector = label.querySelector(".datatable-selector");
                    label.innerHTML = ""; 
                    if (selector) label.appendChild(selector);
                }
                
                bottomLeft.appendChild(topDropdown);
                const info = bottomContainer.querySelector(".datatable-info");
                if (info) bottomLeft.appendChild(info);
                
                bottomContainer.insertBefore(bottomLeft, bottomContainer.firstChild);
            }
        });
    });
</script>
{{ end }}
