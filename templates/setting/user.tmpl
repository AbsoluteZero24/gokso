{{ define "setting/user" }}
<style>
  /* Custom DataTables Styling */
  .datatable-wrapper .datatable-top {
    padding: 15px 0;
    display: flex;
    justify-content: flex-end;
  }
  
  .datatable-wrapper .datatable-bottom {
    padding: 15px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid #dee2e6;
    margin-top: 10px;
  }

  /* Move selector to bottom next to info */
  .datatable-wrapper .datatable-top .datatable-dropdown {
    display: none;
  }

  .datatable-bottom-left {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .datatable-input {
    border: 1px solid #0d6efd;
    border-radius: 8px;
    padding: 8px 15px;
    background-color: #fff;
    color: #000;
    transition: all 0.3s ease;
    min-width: 250px;
  }

  .datatable-input:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    outline: none;
    border-color: #0b5ed7;
  }

  .datatable-selector {
    border: 1px solid #0d6efd;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
    background-color: #fff;
    color: #000;
  }

  /* Premium Table Styling */
  #userTable {
    border-collapse: separate !important;
    border-spacing: 0 !important;
    border: 1px solid #dee2e6 !important;
    border-radius: 10px !important;
    overflow: hidden !important;
  }

  #userTable thead th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #0d6efd !important;
    font-weight: 600;
    color: #333;
    padding: 12px;
  }

  #userTable tbody td {
    border: 1px solid #dee2e6 !important;
    padding: 12px;
    vertical-align: middle;
  }

  #userTable tbody tr:hover {
    background-color: #f1f7ff;
    transition: background-color 0.2s;
  }

  .badge {
    padding: 6px 10px;
    border-radius: 6px;
    font-weight: 500;
  }

  /* Fixed Sequential Row Numbering */
  #userTable {
    counter-reset: rowNumber;
  }
  #userTable tbody tr {
    counter-increment: rowNumber;
  }
  #userTable tbody tr td:first-child::before {
    content: counter(rowNumber) ".";
  }
</style>

<div class="app-content-header">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-6">
                <h3 class="mb-0">{{ .title }}</h3>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">User Management</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<div class="app-content">
    <div class="container-fluid">
        {{ if .error }}
        <div class="alert alert-danger alert-dismissible fade show shadow-sm border-0 mb-4" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {{ .error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {{ end }}

        {{ if .msg }}
        <div class="alert alert-success alert-dismissible fade show shadow-sm border-0 mb-4" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            {{ .msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {{ end }}

        <div class="card">
            <div class="card-header d-flex align-items-center justify-content-between">
                <h3 class="card-title">Daftar User Admin</h3>
                <div class="card-tools ms-auto">
                    <a href="/setting/user/create" class="btn btn-primary btn-sm">
                        <i class="bi bi-plus-lg"></i> Tambah User
                    </a>
                </div>
            </div>
            <div class="card-body">
                <table class="table table-bordered" id="userTable">
                    <thead>
                        <tr>
                            <th style="width: 50px">No</th>
                            <th>Nama Karyawan</th>
                            <th>Username</th>
                            <th>Role</th>
                            <th>Created At</th>
                            <th style="width: 150px">Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{ range $index, $admin := .admins }}
                        <tr>
                            <td class="text-center fw-medium"></td>
                            <td>
                                <div><strong>{{ $admin.EmployeeName }}</strong></div>
                                <small class="text-muted">{{ $admin.NIK }}</small>
                            </td>
                            <td><code>{{ $admin.Username }}</code></td>
                            <td>
                                {{ if eq $admin.Role "super_admin" }}
                                <span class="badge bg-primary">Super Admin</span>
                                {{ else if eq $admin.Role "asset_manager" }}
                                <span class="badge bg-info">Asset Manager</span>
                                {{ else if eq $admin.Role "staf_it" }}
                                <span class="badge bg-success">Staf IT</span>
                                {{ else }}
                                <span class="badge bg-secondary">Support</span>
                                {{ end }}
                            </td>
                            <td>{{ $admin.CreatedAt.Format "02/01/2006 15:04" }}</td>
                            <td>
                                <a href="/setting/user/edit/{{ $admin.ID }}" class="btn btn-warning btn-sm">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="/setting/user/delete/{{ $admin.ID }}" class="btn btn-danger btn-sm" onclick="return confirm('Yakin ingin menghapus user ini?')">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {{ end }}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tableElement = document.getElementById('userTable');
        if (tableElement) {
            const dataTable = new simpleDatatables.DataTable(tableElement, {
                searchable: true,
                fixedHeight: false,
                perPage: 10,
                labels: {
                    placeholder: "Cari user admin...",
                    perPage: "{select}",
                    noRows: "Data tidak ditemukan",
                    info: "Menampilkan {start} sampai {end} dari {rows} data",
                },
                columns: [
                    { select: 0, sortable: false }
                ]
            });

            // Move the selector to bottom after init
            dataTable.on("datatable.init", () => {
                const topDropdown = document.querySelector(".datatable-top .datatable-dropdown");
                const bottomContainer = document.querySelector(".datatable-bottom");
                
                if (topDropdown && bottomContainer) {
                    const bottomLeft = document.createElement("div");
                    bottomLeft.className = "datatable-bottom-left";
                    
                    // Clone the dropdown to move it
                    const newDropdown = topDropdown.cloneNode(true);
                    newDropdown.style.display = "block";
                    
                    // Clear any leftover text like "{select}" from the label
                    const label = newDropdown.querySelector("label");
                    if (label) {
                        const selector = label.querySelector(".datatable-selector");
                        label.innerHTML = "";
                        if (selector) label.appendChild(selector);
                    }
                    
                    bottomLeft.appendChild(newDropdown);
                    
                    const info = bottomContainer.querySelector(".datatable-info");
                    if (info) bottomLeft.appendChild(info);
                    
                    bottomContainer.insertBefore(bottomLeft, bottomContainer.firstChild);
                    topDropdown.remove();

                    const newSelector = newDropdown.querySelector(".datatable-selector");
                    if (newSelector) {
                        newSelector.addEventListener("change", (e) => {
                            dataTable.page.len(parseInt(e.target.value));
                        });
                    }
                }
            });
        }
    });
</script>
{{ end }}
